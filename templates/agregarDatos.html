{% extends "base_init.html" %}
{% block title %}Ingresando Datos Históricos{% endblock %}
{% load static %}
{% block content %}
    <link rel="stylesheet" href="{% static 'home.css' %}"/>
    <div class="container">
        <header>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'homeAdministrador' %}">Inicio</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Variables</li>
                </ol>
            </nav>
            <h1>Ingresando datos históricos</h1>
            <br>
        </header>
        <br>
        <div class="d-flex justify-content-end">
            <button type="button" id="importExcel" class="btn btn-dark ms-2">Importar desde Excel</button>
            <input type="file" id="fileInput" accept=".xlsx, .xls" style="display: none;">
            <button type="button" id="toggleColumns" class="btn btn-dark ms-2">Ocultar/Mostrar Ciclos</button>
        </div>
        <br>
        <div class="card" style="width: 75rem;">
            <div class="card-body">
                <form id="dataForm" method="post" action="{% url 'agregarDatos' %}">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="idPeriodo">Periodo Académico:</label>
                        <select name="idPeriodo" id="idPeriodo" class="form-control" required>
                            <option value="">Seleccione un periodo</option>
                            {% for periodo in periodos %}
                                <option value="{{ periodo.id }}">{{ periodo.nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-borderless">
                            <thead>
                                <tr>
                                    <th>Ciclo</th>
                                    <th class="cycle-col" data-cycle="1">1</th>
                                    <th class="cycle-col" data-cycle="2">2</th>
                                    <th class="cycle-col" data-cycle="3">3</th>
                                    <th class="cycle-col" data-cycle="4">4</th>
                                    <th class="cycle-col" data-cycle="5">5</th>
                                    <th class="cycle-col" data-cycle="6">6</th>
                                    <th class="cycle-col" data-cycle="7">7</th>
                                    <th class="cycle-col" data-cycle="8">8</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Matriculados</td>
                                    <td><input type="text" name="matriculados_1" class="form-control cycle" data-type="matriculados" data-cycle="1"></td>
                                    <td><input type="text" name="matriculados_2" class="form-control cycle" data-type="matriculados" data-cycle="2"></td>
                                    <td><input type="text" name="matriculados_3" class="form-control cycle" data-type="matriculados" data-cycle="3"></td>
                                    <td><input type="text" name="matriculados_4" class="form-control cycle" data-type="matriculados" data-cycle="4"></td>
                                    <td><input type="text" name="matriculados_5" class="form-control cycle" data-type="matriculados" data-cycle="5"></td>
                                    <td><input type="text" name="matriculados_6" class="form-control cycle" data-type="matriculados" data-cycle="6"></td>
                                    <td><input type="text" name="matriculados_7" class="form-control cycle" data-type="matriculados" data-cycle="7"></td>
                                    <td><input type="text" name="matriculados_8" class="form-control cycle" data-type="matriculados" data-cycle="8"></td>
                                    <td><input type="text" class="total" data-type="matriculados" readonly></td>
                                </tr>
                                <tr>
                                    <td>Aprobados</td>
                                    <td><input type="text" name="aprobados_1" class="form-control cycle" data-type="aprobados" data-cycle="1"></td>
                                    <td><input type="text" name="aprobados_2" class="form-control cycle" data-type="aprobados" data-cycle="2"></td>
                                    <td><input type="text" name="aprobados_3" class="form-control cycle" data-type="aprobados" data-cycle="3"></td>
                                    <td><input type="text" name="aprobados_4" class="form-control cycle" data-type="aprobados" data-cycle="4"></td>
                                    <td><input type="text" name="aprobados_5" class="form-control cycle" data-type="aprobados" data-cycle="5"></td>
                                    <td><input type="text" name="aprobados_6" class="form-control cycle" data-type="aprobados" data-cycle="6"></td>
                                    <td><input type="text" name="aprobados_7" class="form-control cycle" data-type="aprobados" data-cycle="7"></td>
                                    <td><input type="text" name="aprobados_8" class="form-control cycle" data-type="aprobados" data-cycle="8"></td>
                                    <td><input type="text" class="total" data-type="aprobados" readonly></td>
                                </tr>
                                <tr>
                                    <td>Reprobados</td>
                                    <td><input type="text" name="reprobados_1" class="form-control cycle" data-type="reprobados" data-cycle="1"></td>
                                    <td><input type="text" name="reprobados_2" class="form-control cycle" data-type="reprobados" data-cycle="2"></td>
                                    <td><input type="text" name="reprobados_3" class="form-control cycle" data-type="reprobados" data-cycle="3"></td>
                                    <td><input type="text" name="reprobados_4" class="form-control cycle" data-type="reprobados" data-cycle="4"></td>
                                    <td><input type="text" name="reprobados_5" class="form-control cycle" data-type="reprobados" data-cycle="5"></td>
                                    <td><input type="text" name="reprobados_6" class="form-control cycle" data-type="reprobados" data-cycle="6"></td>
                                    <td><input type="text" name="reprobados_7" class="form-control cycle" data-type="reprobados" data-cycle="7"></td>
                                    <td><input type="text" name="reprobados_8" class="form-control cycle" data-type="reprobados" data-cycle="8"></td>
                                    <td><input type="text" class="total" data-type="reprobados" readonly></td>
                                </tr>
                                <tr>
                                    <td>Desertores</td>
                                    <td><input type="text" name="desertores_1" class="form-control cycle" data-type="desertores" data-cycle="1"></td>
                                    <td><input type="text" name="desertores_2" class="form-control cycle" data-type="desertores" data-cycle="2"></td>
                                    <td><input type="text" name="desertores_3" class="form-control cycle" data-type="desertores" data-cycle="3"></td>
                                    <td><input type="text" name="desertores_4" class="form-control cycle" data-type="desertores" data-cycle="4"></td>
                                    <td><input type="text" name="desertores_5" class="form-control cycle" data-type="desertores" data-cycle="5"></td>
                                    <td><input type="text" name="desertores_6" class="form-control cycle" data-type="desertores" data-cycle="6"></td>
                                    <td><input type="text" name="desertores_7" class="form-control cycle" data-type="desertores" data-cycle="7"></td>
                                    <td><input type="text" name="desertores_8" class="form-control cycle" data-type="desertores" data-cycle="8"></td>
                                    <td><input type="text" class="total" data-type="desertores" readonly></td>
                                </tr>
                                <tr>
                                    <td>Foráneos</td>
                                    <td><input type="text" name="foraneos_1" class="form-control cycle" data-type="foraneos" data-cycle="1"></td>
                                    <td><input type="text" name="foraneos_2" class="form-control cycle" data-type="foraneos" data-cycle="2"></td>
                                    <td><input type="text" name="foraneos_3" class="form-control cycle" data-type="foraneos" data-cycle="3"></td>
                                    <td><input type="text" name="foraneos_4" class="form-control cycle" data-type="foraneos" data-cycle="4"></td>
                                    <td><input type="text" name="foraneos_5" class="form-control cycle" data-type="foraneos" data-cycle="5"></td>
                                    <td><input type="text" name="foraneos_6" class="form-control cycle" data-type="foraneos" data-cycle="6"></td>
                                    <td><input type="text" name="foraneos_7" class="form-control cycle" data-type="foraneos" data-cycle="7"></td>
                                    <td><input type="text" name="foraneos_8" class="form-control cycle" data-type="foraneos" data-cycle="8"></td>
                                    <td><input type="text" class="total" data-type="foraneos" readonly></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button type="submit" class="btn btn-dark mt-3">Guardar</button>
                    <button type="button" class="btn btn-dark mt-3" data-bs-toggle="modal" data-bs-target="#modificarModal">Modificar registros existentes</button>
                </form>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.2/xlsx.full.min.js"></script>
    <script src="{% static '/agregarDatosH.js' %}"></script>
    <script>
        document.querySelectorAll('input[type="text"]').forEach(function(input) {
            input.addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '');
            });
        });
    </script>
<!-- Modal -->
<div class="modal fade" id="modificarModal" tabindex="-1" aria-labelledby="modificarModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modificarModalLabel">Modificar Registros</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Formulario dentro del modal -->
        <div class="mb-3">
          <label for="selectPeriodo" class="form-label">Seleccionar Periodo Académico</label>
          <select class="form-select" id="selectPeriodo">
            <option selected disabled>Seleccione un periodo</option>
            {% for periodo in periodos %}
              <option value="{{ periodo.id }}">{{ periodo.nombre }}</option>
            {% endfor %}
          </select>
          <button id="btnSeleccionarPeriodo" class="btn btn-secondary mt-2">Seleccionar</button>
        </div>

        <!-- Tabla de datos -->
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Ciclo</th>
              <th>1</th>
              <th>2</th>
              <th>3</th>
              <th>4</th>
              <th>5</th>
              <th>6</th>
              <th>7</th>
              <th>8</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody id="tablaDatos">
            <tr>
              <td>Matriculados</td>
              <td><input type="number" class="form-control" data-field="matriculados_1" /></td>
              <td><input type="number" class="form-control" data-field="matriculados_2" /></td>
              <td><input type="number" class="form-control" data-field="matriculados_3" /></td>
              <td><input type="number" class="form-control" data-field="matriculados_4" /></td>
              <td><input type="number" class="form-control" data-field="matriculados_5" /></td>
              <td><input type="number" class="form-control" data-field="matriculados_6" /></td>
              <td><input type="number" class="form-control" data-field="matriculados_7" /></td>
              <td><input type="number" class="form-control" data-field="matriculados_8" /></td>
              <td id="total_matriculados">0</td>
            </tr>
            <tr>
              <td>Aprobados</td>
              <td><input type="number" class="form-control" data-field="aprobados_1" /></td>
              <td><input type="number" class="form-control" data-field="aprobados_2" /></td>
              <td><input type="number" class="form-control" data-field="aprobados_3" /></td>
              <td><input type="number" class="form-control" data-field="aprobados_4" /></td>
              <td><input type="number" class="form-control" data-field="aprobados_5" /></td>
              <td><input type="number" class="form-control" data-field="aprobados_6" /></td>
              <td><input type="number" class="form-control" data-field="aprobados_7" /></td>
              <td><input type="number" class="form-control" data-field="aprobados_8" /></td>
              <td id="total_aprobados">0</td>
            </tr>
            <tr>
              <td>Reprobados</td>
              <td><input type="number" class="form-control" data-field="reprobados_1" /></td>
              <td><input type="number" class="form-control" data-field="reprobados_2" /></td>
              <td><input type="number" class="form-control" data-field="reprobados_3" /></td>
              <td><input type="number" class="form-control" data-field="reprobados_4" /></td>
              <td><input type="number" class="form-control" data-field="reprobados_5" /></td>
              <td><input type="number" class="form-control" data-field="reprobados_6" /></td>
              <td><input type="number" class="form-control" data-field="reprobados_7" /></td>
              <td><input type="number" class="form-control" data-field="reprobados_8" /></td>
              <td id="total_reprobados">0</td>
            </tr>
            <tr>
              <td>Desertores</td>
              <td><input type="number" class="form-control" data-field="desertores_1" /></td>
              <td><input type="number" class="form-control" data-field="desertores_2" /></td>
              <td><input type="number" class="form-control" data-field="desertores_3" /></td>
              <td><input type="number" class="form-control" data-field="desertores_4" /></td>
              <td><input type="number" class="form-control" data-field="desertores_5" /></td>
              <td><input type="number" class="form-control" data-field="desertores_6" /></td>
              <td><input type="number" class="form-control" data-field="desertores_7" /></td>
              <td><input type="number" class="form-control" data-field="desertores_8" /></td>
              <td id="total_desertores">0</td>
            </tr>
            <tr>
              <td>Foráneos</td>
              <td><input type="number" class="form-control" data-field="foraneos_1" /></td>
              <td><input type="number" class="form-control" data-field="foraneos_2" /></td>
              <td><input type="number" class="form-control" data-field="foraneos_3" /></td>
              <td><input type="number" class="form-control" data-field="foraneos_4" /></td>
              <td><input type="number" class="form-control" data-field="foraneos_5" /></td>
              <td><input type="number" class="form-control" data-field="foraneos_6" /></td>
              <td><input type="number" class="form-control" data-field="foraneos_7" /></td>
              <td><input type="number" class="form-control" data-field="foraneos_8" /></td>
              <td id="total_foraneos">0</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" id="btnGuardarCambios">Guardar Cambios</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}